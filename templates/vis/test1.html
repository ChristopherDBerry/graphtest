<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Dexter graph</title>

    <style type="text/css">
      html,
      body,
      #mynetwork {
        font-family: Arial;
        margin: 0px;
        padding: 0px;
      }
      #mynetwork {
        position: fixed;
        left: 0px;
        top: 0px;
        bottom: 0px;
        right: 10%;
        min-height: 100vh;
        border-right: 1px solid lightgray;
        background: white;
      }

      #text {
        position: absolute;
        left: 90%;
        padding: 1em;
      }

      #mynetwork div.vis-tooltip {
        color: #000000;
        background-color: #ffffff;
        background: white;
      }

    </style>

    <script src="https://code.jquery.com/jquery-3.6.3.min.js" integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script>
    <script src="/static/script/vis-network.js"></script>

  </head>

  <body>
    <div id="text">
      <label for="distance">Distance from homepage:</label>
      <select style="display:none;" name="distance" id="distance">
        <option value="1" selected="selected">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
      </select>
    </div>

    <div id="mynetwork"></div>
    <script type="text/javascript">

var NODES = new vis.DataSet([])
var EDGES = new vis.DataSet([])

var DISTANCE = {}

function htmlTitle(url, screenshot_url) {
  if (screenshot_url) {
      var html = "<div style='text-align: center; background-color: white; width:100%;height:100%;'>" +
        "<div style='width:120px;height:120px; overflow:hidden;'>" +
          "<img src='" + screenshot_url +
          "' style='width:120px;'> " +
        "</div>" +
        "<p>" + url + "</p>" +
      "</div>"
  } else {
      var html = "<div style='text-align: center; background-color: white; width:100%;height:100%;'>" +
        "<p>" + url + "</p>" +
      "</div>"
  }
  const container = document.createElement("div");
  container.innerHTML = html;
  return container;
}

var container = document.getElementById("mynetwork")
var options = {
  physics: {
      stabilization: {
          enabled: true,
          iterations: 125, // maximum number of iteration to stabilize
          updateInterval: 10,
          onlyDynamicEdges: false,
          fit: true
      },
  },
  interaction:{
    hover: true,
    tooltipDelay: 30,
  },
  nodes: {
    color: {
      hover: {
        border: 'black',
      },
      border: '#EEEEEE',
    },
    borderWidth: 1,
    shape: 'dot',
    scaling: {
      min: 6,
      max: 12,
    },
  },
  edges: {
    dashes: true,
    smooth: false,
    color: {
      color: '#E1E1E1',
    },
    chosen: {
      edge: function(values, id, selected, hovering) {
        values.dashes = false;
        values.width = 0.25;
        values.color = '#444444';
      },
    },
  },
  groups: {
    ok: {
      color: {
        background: 'green',
      }
    },
    warning: {
      color: {
        background: 'orange',
      }
    },
    error: {
      label: '',
      color: {
        background: 'red',
      }
    },
    cluster: {
      value: 1,
      font: '32px arial black',
      shape: 'box',
      scaling: {
        min: 32,
        max: 32,
          label: {
            enabled: true,
            min: 32,
            max: 32,
            maxVisible: 32,
            drawThreshold: 5,
          },
      },
      color: {
        background: 'white',
      },
      chosen: {
        node: function(values, id, selected, hovering) {
          values.color = '#F1F1F1';
        },
      },
    }
  }
}

var data = {
  nodes: NODES,
  edges: EDGES,
}
var network = new vis.Network(container, data, options)
network.on('startStabilizing', forceStop);

function redrawMain(distance, nodes, edges) {
  NODES.clear()
  EDGES.clear()
  NODES.add(DISTANCE[distance].nodes)
  EDGES.add(DISTANCE[distance].edges)
  network.stabilize()
  forceStop()
}

function forceStop() {
  setTimeout(function () {
    network.stopSimulation()
  }, 2.0 * 1000)
}

$(function() {

$("#distance").change(function() {
  var distance = $(this).val()
  redrawMain(distance, data.nodes, data.edges)
})

$.get('/json/vis/pages/1', function(data) {
  for (var node of data.nodes) {
    if (node.url)
      node.title = htmlTitle(node.url, node.screenshot_url)
  }
  DISTANCE['1'] = {nodes: data.nodes, edges: data.edges}
  redrawMain('1', data.nodes, data.edges)
  $.get('/json/vis/pages/2', function(data) {
    DISTANCE['2'] = {nodes: data.nodes, edges: data.edges}
    for (var node of data.nodes) {
      if (node.url)
        node.title = htmlTitle(node.url, node.screenshot_url)
    }
    $.get('/json/vis/pages/3', function(data) {
      DISTANCE['3'] = {nodes: data.nodes, edges: data.edges}
      for (var node of data.nodes) {
        if (node.url)
          node.title = htmlTitle(node.url, node.screenshot_url)
      }
      $("#distance").show()
    })
  })
})

})

    </script>
  </body>
</html>
